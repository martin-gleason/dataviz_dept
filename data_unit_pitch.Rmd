---
title: Data, Research, and Visualization Unit
author: Martin Gleason, MS
output:
  xaringan::moon_reader:
    css: ["libs/remark-css/default.css", "pro_presentation.css"]
    self_contained: no
    lib_dir: libs
    seal: false
    nature:
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
```{r setup, include= FALSE, echo = FALSE, warning=FALSE}
library(kableExtra)
source("cleaning_aoic.R")

```
 
# Executive Summary
  
* The department should invest staffing resources into a Data, Research, and Visualization unit.

* This unit would do the following:
  * Collect, clean, analyze, and present department data
  * Collaborate with stakeholders across the Juvenie Justice System
  * Provide information and insight to the entire department
  * Prepare the deparment to transition to [CFive's Supervisor](https://www.cfive.com/products/supervisor/)'s data collection, reporting, and dashboards features
    * Work with the [Cook County Geographic Information Systems Department](https://www.cookcountyil.gov/agency/geographic-information-systems-gis-0) to create new, data driven tools. 
    
---
## Data, Research, and Visualization Unit's Benefits

* Solves the *mission critical* need of evidenced-based practices within established financial restrictions

* Maximize the investment in *CFive Supervisor.*

* Efficiently transforms data into information and insight

* Allow the Department to tell its own data-driven stories to Juvenile Justice stakeholders
  
* Idenitfy and address concerns of equity across the department
  *  Racial, class, caseload, unit, division, and section
---
# Unit Mission Statement

.left-plot[![:scale 85%](imgs/d_v_unit.jpg)]
.right-code[
It is the policy of the Cook County Juvenile Probation and Court Services Department to maintain the highest level of data integrity within the department, and with community partners, in order to develop polices, procedures, and programs that enhance the probablity of long term success for all young people under the care of the court.]

---
.pull-left[
### Unit Makeup
* Unit Structure
  * Two support professionals 
  * The CFive System Administrator
  * Program manager officers
]
.pull-right[
### Unit Responsibilities
* Collect, clean, and store data
* Reformat forms and reports to reflect department needs
* Assist the department and community partners in evaluating program effectiveness
* Maintain and leverage the Department's data sharing agreements
* Expand the development of *CFive's* reporting and data visualization capabilities
]

<br  />
.center[It is not a revolutionary change, it is simply an evolution of the departments capabilities and opportunities]

---
# Evolving Practices

* *CFive* will change how the Department collects data and reports on data.
  * Collecting will be standarized, but reporting and dashboards represent an opportunity for growth

* The department can redesign reports for
  * Readability
      * *Easy to read and digest*
    
  * Portability
      * *Shareable regardless of format*
    
  * Reproducible
      * *Reports can be rerun with new data for new insights*

---
# Example: AOIC Stats 

Consider the current AOIC report, presented in the following format:

```{r first_8, include = TRUE, echo = FALSE}

first_eight <- head(June)

first_eight %>% 
  kable( format = "html") %>%
  kable_styling(bootstrap_options = c("condensed", "hover", "responsive", "condensed "), 
                font_size = 14) %>%
  scroll_box(width = "720px", height = "425px")

``` 
---
## Example: AOIC Stats 
* The first of the eight columns contain the DCPO, SPO, and police district. 

* The next seven columns contain the PO's caseload data.

* The remaining columns are a combination of: 
  * Unit 
  * Division
  * Department
  * Calculated values, such as: 
    * Caseload totals
    * Averages across the department

---
# Issues with this format

* Storing and presenting AOIC data in this fashion limits additional investigation of this data 

  * Multiple spreadsheets must be created and merged depending on the necessary information

  * Compiling said spreadsheets increases the chances of errors:
      * Due to spelling mistakes
      * Accidentally deleting spreadsheet structure
      * Over-writing spreadsheets while saving them
      
* Excel does not become a website or a slide presentation easily
  * Tables and graphs must be cut and pasted into the next format.
  
---
# The Solution: Tidy Data
.center[![:scale 45%](imgs/tidy_data1.png)]

* Implementing [tidy data](http://vita.had.co.nz/papers/tidy-data.html) is a critical step in creating a data-driven department

* Tidy data is short hand for:
    * Columns are single variable
    * Rows are single observation
    * Each observational unit forms a table
    * A move away from analysis in Excel

---
# AOIC Revisited
```{r tidy, include=TRUE, echo = FALSE, message = FALSE}
  cal_55_2 %>% 
    tidy_up() %>% 
    kable(booktabs = TRUE, format = "html", caption = "GBO: September, 2018") %>%
  kable_styling(bootstrap_options = c("condensed", "hover"), font_size = 18) %>%
  scroll_box(width = "720px", height = "425px")

```
---
## New Format: Pros and Cons

.pull-left[
### Cons
* It is difficult to read a 17-column<sup>1</sup> wide table
  *   Scroll bars on web versions make it tolerable
  *   Print versions requires changing layout or font size
  *   PDFs can allow for "zooming in" on particular rows and columns
  *   These solutios also typically apply to Excel
]
.pull-right[
### Pros
* Allows for computed variables (average, total number of POs) by the software
* Tidy format allows for faster selection and filtering of specific items
* Tidy data allows for faster, and easier, combinations of data sets
  * For example, combining GIS, OCJ, and CTA Data
]
<br />
.footnote[1: The columns are: *`r names(cal_55_2 %>% tidy_up()) %>% as.vector()`*]
---
## New Format: Visualizations
* *Tidy format is built to be analyzed, not presented as 17 column report*

```{r tidy_1, include=TRUE, echo=FALSE, message = FALSE}

lloyd <-  cal_55_2 %>% 
    tidy_up() 

cal_57 %>%
  tidy_up() %>%
  bind_rows(lloyd) %>% 
  select(`PO Name` = 1, High = `YASI HIGH`, Mod = `YASI MOD`, 
         Low = `YASI LOW`, Unclassified = `YASI UNCLASSIFIED`, SPO) %>%
  rowwise() %>%
  mutate(Total = sum(Low, Mod, High, Unclassified)) %>%
  select(`PO Name`, SPO, High, Mod, Low, Unclassified, Total) %>%
  arrange(desc(High, SPO)) %>%
  kable(booktabs = TRUE, format = "html", caption = "GBO and Lawndale: September, 2018") %>%
  kable_styling(bootstrap_options = c("condensed", "hover"), font_size = 18) 
```

* This table focuses only on case load and risk levels
  * It is the same data as the 17 column table

---
# Calculations 

.center[![](imgs/colbert-calculator.gif)]

</br>
Computed AOIC Stats (averages, medians, etc) can be computed and displayed through this format

---
## Caseload Numbers and Averages

```{r summary_table, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}
lloyd <-  cal_55_2 %>% 
    tidy_up() 

cal_53_8_tidy <- cal_53_8 %>%
  tidy_up()

cal_75_tidy <- cal_75 %>%
  tidy_up()

cal_68_tidy <- cal_68 %>%
  tidy_up()

#turn into function

cal_55_60_63_tidy <- cal_55_60_63 %>%
  tidy_up()

cal_57 %>%
  tidy_up() %>%
  bind_rows(lloyd) %>% 
  bind_rows(cal_53_8_tidy) %>%
  bind_rows(cal_75_tidy) %>%
  bind_rows(cal_68_tidy) %>%
  bind_rows(cal_55_60_63_tidy) %>%
  rowwise() %>%
  mutate(Total = sum(`YASI LOW`, `YASI MOD`, `YASI HIGH`, `YASI UNCLASSIFIED`)) %>%
  group_by(SPO) %>%
  summarize(`Total Officers` = n(),
            `Total Cases` = sum(Total),
             `Average Caseload` = ceiling(`Total Cases`/`Total Officers`)) %>%
  kable(booktabs = TRUE, format = "html", caption = "Case Totals: September, 2018") %>%
  kable_styling(bootstrap_options = c("condensed", "hover"), font_size = 20)


```

* Unlike the Excel format, this document seperates data and computation

* Reusable code is more reliable, readable, and portable than an frequently updated spreadsheet

---
# Tidy Format and Graphs
.left-code[
* The tidy format is built for visualizations

* This work is done in `R` and R Markdown
  * Can just as easily be done in another language
  * The department has these tools as part of the database software we use

* Like Excel, these tools can create graphs

* Unlike Excel, these graphs are designed with reproducibility in mind
]
.right-plot[
```{r SI_VOP, include= TRUE, echo = TRUE, eval = TRUE, dpi = 300, fig.cap="Socials and VOPs in GBO and Lawndale"}

lloyd <-  cal_55_2 %>% 
    tidy_up() 

cal_57 %>%
  tidy_up() %>%
  bind_rows(lloyd) %>% 
  select(1, `Social Investigation` =`Social investigation`, 
         `VOP` = `VOP Filed`) %>%
  gather( c(`Social Investigation`, `VOP`), key = Social_VOP, 
          value = Totals) %>%
  ggplot(aes(x = PO_Name, y = Totals, fill = `Social_VOP`)) + 
  geom_bar(stat = "identity", position = "dodge") +
  viridis::scale_fill_viridis(discrete = TRUE, 
                              name = "Socials and VOP") +
  labs(title = "GBO and Lawndale, September 2018",
       x = "PO Name", y = "Client Totals") +
  coord_flip()
```
]
---
# Code, Tables, Graphs

* What makes this method superior to Excel is that the above code can be reused with a similar data set
  * With Excel, each month need to be recalculated
  * The tidy method allows for code to be reused with limited changes
     *  Additional data or transformations can be included with code and not another spreadsheet

* `R` puts code, calculated values, and visiulzaitons in the same document
  * No need to cut and paste tables and charts
  * Improves portablity, readablity, and reproducibility

---
# Shiny
* An `R` server tool that makes web apps:
  * Dashboards, programmable reports, data entry and analysis tools

* Additional examples of how Shiny can be used can be found [here.](https://shiny.rstudio.com/gallery/)

* Additional resources required:
  * Server space
  * Web Server for internal websites

---
# GIS
* The Cook County Geographic Information Systems department is willing to work with the Department

* A Data, Research, and Visualization unit would be able to build internal capacity to utilize GIS tools to go beyond dashboards

* Even minimal partnerships would for the creation of regular programmable reports:
  * Unit level heat maps of risk levels
  * Neighborhood "hot spots."
  * Risk and success rates by commissioner district
  
---
# Data, Research, and Visualization Unit
* A unit with this mission will be able to
  * Create, modify, and generate standard reports for the department
  * Improve data integrity across the department
  * Provide insight into new areas for programming and policy

* Condensing existent department resources into a mission-focused unit will quickly create opportunities for ROI
